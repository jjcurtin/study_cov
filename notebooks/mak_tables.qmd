---
title: "Make Tables for Main Manuscript"
author: "Lauren Khoury and Kendra Wyant"
date: "`r lubridate::today()`"
number-sections: true
output: 
  html_document:
    toc: true 
    toc_depth: 4
format:
  html:
    embed-resources: true
    toc: true
    toc-depth: 4
editor_options: 
  chunk_output_type: console
html-table-processing: none
---

```{r}
library(skimr)
library(cowplot)
library(tidyverse)
library(kableExtra, exclude = ("group_rows"))

options(digits = 3)
options(knitr.kable.NA = '')

devtools::source_url("https://github.com/jjcurtin/lab_support/blob/main/format_path.R?raw=true") |> suppressMessages()

rdrive_path <- format_path("cov/raw_data")
table <- read_csv(here::here(rdrive_path, "estimate_table.csv"),
                  show_col_types = FALSE)

```

```{r}
lm_methods <- tibble(Method = c("No covariates", "All covariates", "p-hacking",
                  "Single covariate linear model without X", "Single covariate linear model with X",
                  "All covariates linear model without X", "All covariates linear model with X",
                  "All covariates LASSO without X", "All covariates LASSO with X"),
       Definition = c("Y is regressed on X without any covariates.",
                      "All available covariates are included in the regression model.",
                      "Unsystematically adding covariates based on whether they lower the p-value of the main effect of X on Y.",
                      "A linear model that regresses Y on a single covariate. Covariates are considered one at a time and included in the final model if they yield a significant effect on Y (p < .05).",
                      "A linear model that regresses Y on a single covariate and X. Covariates are considered one at a time and included in the final model if they yield a significant effect on Y (p < .05).",
                      "A full linear model that regresses Y on all available covariates. Covariates that have a statistically significant effect on Y (p < .05) are retained.",
                      "A full linear model that regresses Y on all available covariates and X. Covariates that have a statistically significant effect on Y (p < .05) when controlling for X are retained.",
                      "A linear model that regresses Y on all available covariates and applies a penalty to shrink coefficients for less important covariates, potentially dropping them altogether (i.e., coefficient of 0). Covariates with non-zero coefficients were retained.",
                      "A linear model that regresses Y on all available covariates and applies a penalty to shrink coefficients for less important covariates. We assigned a 0 penalty to X to retain it in the model. Covariates with non-zero coefficients when controlling for X were retained."))
```

```{r}
#| label: tbl-methods
#| tbl-cap: The nine linear regression models and their definition for covariate selection.

lm_methods |> 
  kbl(escape = FALSE) |> 
  kable_classic()
```



```{r}
#| label: tbl-dictionary
#| tbl-cap: "Research setting variables and values"

data_tbl0 <- tibble(
  description = c(
    "The population parameter for X",
    "The number of observations in the sample",
    "The number of covariates",
    "The proportion of \"good\" covariates",
    "The correlation between Y and good covariates"),
  values = c("0, 0.3, 0.5",
             "50, 100, 150, 200, 300, 400", 
             "4, 8, 12, 16, 20", 
             "0.25, 0.50, 0.75",
             "0.3, 0.5" 
             )
)

data_tbl0 |>
  kbl(col.names = c("Research Setting Variable", "Values"), 
      escape = FALSE) |>
  kable_styling(bootstrap_options = c("striped", "hover"), 
                full_width = FALSE) |>
  column_spec(1, width = "15em") |>
  column_spec(2, width = "10em")

```



```{r}
#| label: tbl-est
#| tbl-cap: "Mean estimates of effect size by method and true effect size"
#| warning: false

table |> 
  rename(Method = method, 
         `No effect` = `b_x = 0`,
         `d = .3` = `b_x = .3`,
         `d = .5` = `b_x = .5`) |> 
  mutate(Method = factor(Method, 
                         levels = c("No covariates", "All covariates", "p-hacking", 
                                    "Single covariate lm", "Single covariate lm with X", 
                                    "All covariates lm", "All covariates lm with X", 
                                    "All covariates LASSO", "All covariates LASSO with X"),
                         labels = c("No covariates", "All covariates", "p-hacking", 
                                    "Single covariate lm without X", 
                                    "Single covariate lm with X", 
                                    "All covariates lm without X", 
                                    "All covariates lm with X", 
                                    "All covariates LASSO without X", 
                                    "All covariates LASSO with X")),
         `No effect` = sprintf("%.3f", `No effect`)) |> 
  arrange(Method) |> 
  add_row(Method = "Researcher selection", .before = 1) |> 
  add_row(Method = "Data-driven selection", .after = 3) |> 
  kable() |> 
  kable_classic() |> 
  pack_rows(NULL, 2, 3) |> 
  pack_rows(NULL, 5, 11)
```

